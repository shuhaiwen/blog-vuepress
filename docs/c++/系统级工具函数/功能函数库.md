---
title: 功能函数库
date: 2020-08-31
sidebarDepth: 2
tags:
 - 功能函数库
categories:
 - C++系统级工具函数
---

# 功能函数库
## 获取lacale集
```c++
#include<Windows.h>
#include<string>
using std::wstring;
using std::string;
#ifdef UNICODE
typedef wstring tstring;
#else
typedef string tstring;
#endif // UNICODE


typedef std::vector<tstring> tLocales;
std::vector<tstring> g_locales;

BOOL CALLBACK MyLocaleEnumProc(LPTSTR szLocaleString)
{
    g_locales.push_back(szLocaleString);
    return TRUE;
}

//LCID码转语言和国家全称(English_United States.1252)
tstring& LCID2NLS(LCID lcid, tstring& bstrRetBuf)
{
    TCHAR arcBuf[128];

    memset(arcBuf, 0, sizeof(arcBuf));

    GetLocaleInfo(lcid, LOCALE_SENGLANGUAGE, arcBuf, 127);// English name of language, eg "German"
    bstrRetBuf = arcBuf;
    memset(arcBuf, 0, sizeof(arcBuf));
    //Loading the English name for the country/region
    GetLocaleInfo(lcid, LOCALE_SENGCOUNTRY, arcBuf, 127);// English name of country/region, eg "Germany"
    if (*arcBuf)
    {
        bstrRetBuf += TEXT("_");
        bstrRetBuf += arcBuf;
    }
    //Loading the code page
    memset(arcBuf, 0, sizeof(arcBuf));
    if ((GetLocaleInfo(lcid, LOCALE_IDEFAULTANSICODEPAGE, arcBuf, 127)
        || GetLocaleInfo(lcid, LOCALE_IDEFAULTCODEPAGE, arcBuf, 127))
        && *arcBuf)
    {
        bstrRetBuf += TEXT(".");
        bstrRetBuf += arcBuf;
    }

    return bstrRetBuf;
}

//LCID码转语言和国家缩写（en_US）
tstring& LCID2NLSAbbr(LCID lcid, tstring& bstrRetBuf)
{
    TCHAR arcBuf[128];

    memset(arcBuf, 0, sizeof(arcBuf));

    GetLocaleInfo(lcid, LOCALE_SISO639LANGNAME, arcBuf, 127);// ISO abbreviated language name, eg "en"
    bstrRetBuf = arcBuf;
    memset(arcBuf, 0, sizeof(arcBuf));
    //Loading the English name for the country/region
    GetLocaleInfo(lcid, LOCALE_SISO3166CTRYNAME, arcBuf, 127); // ISO abbreviated country/region name, eg "US"
    if (*arcBuf)
    {
        bstrRetBuf += TEXT("_");
        bstrRetBuf += arcBuf;
    }

    return bstrRetBuf;
}

std::vector<tstring> GetAllLocales(bool isAbbr=true)
{
    EnumSystemLocales(&MyLocaleEnumProc, LCID_INSTALLED);
    std::vector<tstring> vNLS,vNLSAbbr;
    tstring ts;

    for (tLocales::const_iterator i = g_locales.begin(); i != g_locales.end(); i++)
    {
        if (isAbbr) {//en_US
            LCID2NLSAbbr(std::stoul(i->c_str(), nullptr, 16), ts);
            vNLSAbbr.emplace_back(ts);         
        }
        else {//English_United States.1252
            LCID2NLS(std::stoul(i->c_str(), nullptr, 16), ts);
            vNLS.emplace_back(ts);            
        }    
    }
    if (isAbbr) {
        return vNLSAbbr;
    }
    else {
        return vNLS;
    }
}
int main() {
    //获取缩写locale集 en_US
    std::vector<tstring> vstrAbbr= GetAllLocales();
    //获取全称locale集 (English_United States.1252)
    std::vector<tstring> vstr = GetAllLocales(false);
}
```