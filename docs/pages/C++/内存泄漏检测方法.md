---
title: 内存泄漏检测方法
date: 2019-06-03
sidebarDepth: 2
tags:
 - 内存泄漏
categories:
 - C++
---

# 内存泄漏检测方法
下面代码中`#define _CRTDBG_MAP_ALLOC`宏作用是让内存泄漏信息更完善，只适合malloc分配内存，用new不产生额外信息
```c++
#define _CRTDBG_MAP_ALLOC
#include <stdlib.h>
#include <crtdbg.h>

int main()
{
    //方法一:在程序开始位置加上 _CrtSetDbgFlag(_CRTDBG_ALLOC_MEM_DF | _CRTDBG_LEAK_CHECK_DF);
    _CrtSetDbgFlag(_CRTDBG_ALLOC_MEM_DF | _CRTDBG_LEAK_CHECK_DF);
    int* i1 = new int(1);
    int* i2 = (int*)malloc(4);
    //方法二：在程序结束位置加上 _CrtDumpMemoryLeaks();
    _CrtDumpMemoryLeaks();
}
```